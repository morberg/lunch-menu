<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lund Lunch Menus</title>
    <style>
        body {
            font-family: 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #dad7cd;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #344e41;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
        }

        .restaurant {
            background: #faf7ed;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px #cac7bd;
        }

        .day-section {
            margin-bottom: 20px;
        }

        .day-title {
            font-weight: bold;
            color: #3a5a40;
            font-size: 18px;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #588157;
        }

        .menu-item-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .menu-item-price {
            color: #344e41;
            float: right;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 8px;
        }

        th,
        td {
            padding: 4px 6px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background: #f0f0f0;
            font-size: 15px;
        }

        td {
            border-top: 1px solid #eee;
        }

        @media (max-width: 600px) {
            body {
                padding: 6px;
            }

            .restaurant {
                padding: 7px;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Dagens Lunch</h1>
    </header>

    <main>
        <div id="loading" class="loading">
            Laddar menyer...
        </div>

        <div id="content" style="display: none;">
            <!-- Menu content will be loaded here -->
        </div>
    </main>

    <script>
        async function loadMenus() {
            try {
                const response = await fetch('/api/menus');
                const data = await response.json();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                displayMenus(data);
            } catch (error) {
                document.getElementById('loading').innerHTML =
                    '<div class="error">Kunde inte ladda menyer. Försök igen senare.</div>';
                console.error('Error loading menus:', error);
            }
        }
        function displayMenus(data) {
            const content = document.getElementById('content');
            content.innerHTML = '';
            const days = ['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'Hela veckan'];
            const dayMapping = { 'Monday': 'Måndag', 'Tuesday': 'Tisdag', 'Wednesday': 'Onsdag', 'Thursday': 'Torsdag', 'Friday': 'Fredag', 'Hela veckan': 'Hela veckan' };
            const restaurants = [
                { name: 'Edison', key: 'edison', data: data.edison, url: 'https://restaurangedison.se/lunch/' },
                { name: 'Grenden', key: 'grenden', data: data.grenden, url: 'https://www.nordrest.se/restaurang/grenden/' },
                { name: 'Food Hall', key: 'foodhall', data: data.foodhall, url: 'https://www.nordrest.se/restaurang/food-hall/', weeklyOnly: true },
                { name: 'Bricks Eatery', key: 'bricks', data: data.bricks, url: 'https://brickseatery.se/lunch/' },
                { name: 'Kantin', key: 'kantin', data: data.kantin, url: 'https://www.kantinlund.se/' },
                { name: 'Smakapakina', key: 'smakapakina', data: data.smakapakina, url: 'https://www.smakapakina.se/meny' },
                { name: 'Eatery', key: 'eatery', data: data.eatery, url: 'https://eatery.se/anlaggningar/lund' },
            ];

            const restaurantsWithAnyItems = new Set();
            restaurants.forEach(r => { if (Array.isArray(r.data) && r.data.length > 0) restaurantsWithAnyItems.add(r.key); });

            days.forEach(daySv => {
                let anyRestaurantShown = false;
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-section';
                dayDiv.innerHTML = `<div class="day-title">${daySv}</div>`;
                restaurants.forEach(r => {
                    if (r.weeklyOnly && daySv !== 'Hela veckan') {
                        return; // Skip Food Hall for weekday sections
                    }
                    const items = (r.data || []).filter(item => item.day === daySv || dayMapping[item.day] === daySv);
                    if (items.length > 0) {
                        anyRestaurantShown = true;
                        const prices = items.map(i => i.price);
                        const uniquePrices = [...new Set(prices)];
                        const hasUniformPrice = uniquePrices.length === 1;
                        const uniformPrice = hasUniformPrice ? uniquePrices[0] : null;
                        const restaurantDiv = document.createElement('div');
                        restaurantDiv.className = 'restaurant';
                        let restaurantHeader = `<strong><a href="${r.url}" target="_blank" style="color: inherit; text-decoration: none;">${r.name}</a></strong>`;
                        if (hasUniformPrice && uniformPrice !== null) {
                            restaurantHeader += ` <span class="menu-item-price">${uniformPrice} kr</span>`;
                        }
                        restaurantDiv.innerHTML = restaurantHeader;
                        const table = document.createElement('table');
                        table.innerHTML = '<tbody></tbody>';
                        const tbody = table.querySelector('tbody');
                        items.forEach(item => {
                            const tr = document.createElement('tr');
                            if (hasUniformPrice) {
                                tr.innerHTML = `<td style="padding:4px 6px;vertical-align:top;">${item.name}</td>`;
                            } else {
                                const price = (item.price !== null && item.price !== undefined) ? `${item.price} kr` : '-';
                                tr.innerHTML = `<td style="padding:4px 6px;vertical-align:top;">${item.name}</td><td style="padding:4px 6px;text-align:right;vertical-align:top;color:#28a745;">${price}</td>`;
                            }
                            tbody.appendChild(tr);
                        });
                        restaurantDiv.appendChild(table);
                        dayDiv.appendChild(restaurantDiv);
                    } else {
                        // Show placeholder for restaurant with no items that day (only for weekday sections)
                        if (['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag'].includes(daySv)) {
                            anyRestaurantShown = true; // ensure day section appears
                            const placeholderDiv = document.createElement('div');
                            placeholderDiv.className = 'restaurant';
                            placeholderDiv.innerHTML = `<strong><a href="${r.url}" target="_blank" style="color: inherit; text-decoration: none;">${r.name}</a></strong><div style="font-size:13px;color:#666;margin-top:4px;">Ingen meny hittades för ${daySv.toLowerCase()}. Klicka för att besöka.</div>`;
                            dayDiv.appendChild(placeholderDiv);
                        }
                    }
                });
                if (anyRestaurantShown) content.appendChild(dayDiv);
            });

            // Section listing restaurants with zero items all week
            const emptyRestaurants = restaurants.filter(r => !(restaurantsWithAnyItems.has(r.key)));
            if (emptyRestaurants.length) {
                const section = document.createElement('div');
                section.className = 'day-section';
                section.innerHTML = `<div class="day-title">Restauranger utan menydata</div>`;
                emptyRestaurants.forEach(r => {
                    const div = document.createElement('div');
                    div.className = 'restaurant';
                    div.innerHTML = `<strong><a href="${r.url}" target="_blank" style="color: inherit; text-decoration:none;">${r.name}</a></strong><div style="font-size:13px;color:#666;margin-top:4px;">Ingen meny kunde hämtas. Klicka för att besöka deras sida.</div>`;
                    section.appendChild(div);
                });
                content.appendChild(section);
            }

            if (!Object.values(data).some(arr => Array.isArray(arr) && arr.length > 0)) {
                // Keep placeholder but already have per-restaurant placeholders above.
            }
            // Auto-scroll remains same
            const today = new Date();
            const swedishDays = ['Söndag', 'Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'Lördag'];
            const todayName = swedishDays[today.getDay()];
            if (['Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag'].includes(todayName)) {
                const dayTitles = document.querySelectorAll('.day-title');
                for (const el of dayTitles) { if (el.textContent.trim() === todayName) { el.scrollIntoView({ behavior: 'smooth', block: 'start' }); break; } }
            }
        }
        window.addEventListener('DOMContentLoaded', loadMenus);
    </script>
</body>

</html>